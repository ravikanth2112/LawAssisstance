<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Immigration Law Dashboard - Database ERD</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f8f9fa;
            color: #333;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 15px;
        }
        .diagram-container {
            background: white;
            border: 1px solid #e1e8ed;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
        }
        .legend {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .legend h3 {
            color: #495057;
            margin-top: 0;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }
        .legend-symbol {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            border: 1px solid #333;
            display: inline-block;
        }
        .pk { background-color: #ffd700; }
        .fk { background-color: #87ceeb; }
        .uk { background-color: #98fb98; }
        .print-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 20px 0;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        .print-button:hover {
            background: #2980b9;
        }
        @media print {
            .print-button { display: none; }
            body { background: white; }
            .container { box-shadow: none; }
        }
        .table-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .table-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
        }
        .table-card h4 {
            color: #495057;
            margin-top: 0;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }
        .table-card ul {
            list-style: none;
            padding: 0;
        }
        .table-card li {
            margin: 5px 0;
            padding: 3px 0;
            border-bottom: 1px solid #e9ecef;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Immigration Law Dashboard - Database Entity Relationship Diagram</h1>
        
        <button class="print-button" onclick="window.print()">üñ®Ô∏è Print/Save as PDF</button>
        
        <div class="legend">
            <h3>Legend</h3>
            <div class="legend-item">
                <span class="legend-symbol pk"></span>
                <span>PK - Primary Key</span>
            </div>
            <div class="legend-item">
                <span class="legend-symbol fk"></span>
                <span>FK - Foreign Key</span>
            </div>
            <div class="legend-item">
                <span class="legend-symbol uk"></span>
                <span>UK - Unique Key</span>
            </div>
        </div>

        <div class="diagram-container">
            <div class="mermaid">
erDiagram
    USERS {
        int user_id PK
        string email UK
        string password_hash
        string first_name
        string last_name
        string phone
        enum user_type
        datetime created_at
        datetime updated_at
        boolean is_active
    }

    LAWYERS {
        int lawyer_id PK
        int user_id FK
        string bar_number UK
        string license_state
        string specialization
        decimal hourly_rate
        text bio
        datetime admitted_date
        boolean is_partner
    }

    CLIENTS {
        int client_id PK
        int user_id FK
        string client_number UK
        string country_of_origin
        string current_status
        string preferred_language
        date date_of_birth
        string emergency_contact
        string emergency_phone
        text notes
    }

    CASES {
        int case_id PK
        int client_id FK
        int primary_lawyer_id FK
        string case_number UK
        string case_type
        string case_status
        string priority_level
        date filing_date
        date expected_completion
        decimal estimated_cost
        text case_summary
        datetime created_at
        datetime updated_at
    }

    CASE_LAWYERS {
        int case_lawyer_id PK
        int case_id FK
        int lawyer_id FK
        string role
        date assigned_date
        date removed_date
        boolean is_active
    }

    DEADLINES {
        int deadline_id PK
        int case_id FK
        int assigned_lawyer_id FK
        string title
        text description
        datetime due_date
        string priority
        string status
        boolean is_court_deadline
        datetime created_at
        datetime completed_at
    }

    DOCUMENTS {
        int document_id PK
        int case_id FK
        int uploaded_by FK
        string document_name
        string document_type
        string file_path
        string file_extension
        int file_size
        string status
        boolean is_confidential
        datetime uploaded_at
        datetime modified_at
    }

    BILLING {
        int billing_id PK
        int case_id FK
        int lawyer_id FK
        string invoice_number UK
        decimal hours_worked
        decimal hourly_rate
        decimal total_amount
        decimal tax_amount
        string billing_period
        string status
        date invoice_date
        date due_date
        date paid_date
        text description
    }

    PAYMENTS {
        int payment_id PK
        int billing_id FK
        decimal amount_paid
        string payment_method
        string transaction_id
        date payment_date
        string payment_status
        text notes
    }

    ACTIVITIES {
        int activity_id PK
        int case_id FK
        int lawyer_id FK
        string activity_type
        text description
        decimal hours_spent
        date activity_date
        datetime logged_at
        boolean is_billable
    }

    COURT_HEARINGS {
        int hearing_id PK
        int case_id FK
        int lawyer_id FK
        string hearing_type
        datetime scheduled_date
        string court_name
        string judge_name
        string status
        text outcome
        text notes
    }

    COMMUNICATIONS {
        int communication_id PK
        int case_id FK
        int from_user_id FK
        int to_user_id FK
        string communication_type
        string subject
        text content
        datetime sent_at
        boolean is_read
        string priority
    }

    FIRM_SETTINGS {
        int setting_id PK
        string setting_key UK
        string setting_value
        string setting_type
        text description
        datetime updated_at
        int updated_by FK
    }

    USERS ||--o{ LAWYERS : "is_a"
    USERS ||--o{ CLIENTS : "is_a"
    USERS ||--o{ COMMUNICATIONS : "sends"
    USERS ||--o{ COMMUNICATIONS : "receives"
    USERS ||--o{ DOCUMENTS : "uploads"
    USERS ||--o{ FIRM_SETTINGS : "updates"

    LAWYERS ||--o{ CASES : "primary_lawyer"
    LAWYERS ||--o{ CASE_LAWYERS : "assigned_to"
    LAWYERS ||--o{ DEADLINES : "assigned_to"
    LAWYERS ||--o{ BILLING : "bills_for"
    LAWYERS ||--o{ ACTIVITIES : "performs"
    LAWYERS ||--o{ COURT_HEARINGS : "represents"

    CLIENTS ||--o{ CASES : "owns"

    CASES ||--o{ CASE_LAWYERS : "has_lawyers"
    CASES ||--o{ DEADLINES : "has_deadlines"
    CASES ||--o{ DOCUMENTS : "contains"
    CASES ||--o{ BILLING : "generates_billing"
    CASES ||--o{ ACTIVITIES : "has_activities"
    CASES ||--o{ COURT_HEARINGS : "has_hearings"
    CASES ||--o{ COMMUNICATIONS : "relates_to"

    BILLING ||--o{ PAYMENTS : "receives_payments"
            </div>
        </div>

        <h2>Database Tables Overview</h2>
        <div class="table-list">
            <div class="table-card">
                <h4>User Management</h4>
                <ul>
                    <li><strong>USERS</strong> - Base user authentication</li>
                    <li><strong>LAWYERS</strong> - Legal professional profiles</li>
                    <li><strong>CLIENTS</strong> - Immigration client information</li>
                </ul>
            </div>
            
            <div class="table-card">
                <h4>Case Management</h4>
                <ul>
                    <li><strong>CASES</strong> - Central case tracking</li>
                    <li><strong>CASE_LAWYERS</strong> - Multiple lawyers per case</li>
                    <li><strong>DEADLINES</strong> - Court and internal deadlines</li>
                </ul>
            </div>
            
            <div class="table-card">
                <h4>Document Management</h4>
                <ul>
                    <li><strong>DOCUMENTS</strong> - File storage with metadata</li>
                    <li><strong>COMMUNICATIONS</strong> - Communication tracking</li>
                </ul>
            </div>
            
            <div class="table-card">
                <h4>Financial Management</h4>
                <ul>
                    <li><strong>BILLING</strong> - Invoice generation</li>
                    <li><strong>PAYMENTS</strong> - Payment processing</li>
                    <li><strong>ACTIVITIES</strong> - Billable hour tracking</li>
                </ul>
            </div>
            
            <div class="table-card">
                <h4>Legal Process</h4>
                <ul>
                    <li><strong>COURT_HEARINGS</strong> - Court appearance tracking</li>
                </ul>
            </div>
            
            <div class="table-card">
                <h4>System Configuration</h4>
                <ul>
                    <li><strong>FIRM_SETTINGS</strong> - System configuration</li>
                </ul>
            </div>
        </div>

        <h2>Key Features</h2>
        <ul>
            <li><strong>Role-based Access</strong>: Different user types (lawyers, clients, admin)</li>
            <li><strong>Multi-lawyer Cases</strong>: Support for multiple lawyers on complex cases</li>
            <li><strong>Deadline Management</strong>: Court deadlines with priority and status tracking</li>
            <li><strong>Document Security</strong>: Confidentiality controls and version tracking</li>
            <li><strong>Financial Integration</strong>: Time tracking linked to billing</li>
            <li><strong>Communication History</strong>: Complete audit trail of client communications</li>
            <li><strong>Court Management</strong>: Hearing scheduling and outcome tracking</li>
        </ul>

        <div style="margin-top: 40px; text-align: center; color: #6c757d;">
            <p><strong>Immigration Law Dashboard</strong> | Generated on: <span id="date"></span></p>
        </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'base',
            themeVariables: {
                primaryColor: '#3498db',
                primaryTextColor: '#2c3e50',
                primaryBorderColor: '#34495e',
                lineColor: '#7f8c8d',
                secondaryColor: '#ecf0f1',
                tertiaryColor: '#f8f9fa'
            }
        });
        
        document.getElementById('date').textContent = new Date().toLocaleDateString();
    </script>
</body>
</html>
